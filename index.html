<!DOCTYPE html>
<html lang="zh-TW" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>KURA 蔵 | Fashion Archive</title>
    
    <!-- PWA / iOS WebApp 核心設定 -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="KURA 蔵">
    
    <!-- 日系 POP 字體 -->
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700;900&display=swap" rel="stylesheet">
    
    <!-- 基礎庫載入 -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase Compat (最穩定的 CDN) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        :root {
            --sat: env(safe-area-inset-top);
            --sab: env(safe-area-inset-bottom);
        }
        html, body, #root {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #222222;
        }
        body {
            font-family: 'M PLUS Rounded 1c', sans-serif !important;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* 核心修正：防止 iOS 點擊輸入框自動放大 (必須 >= 16px) */
        input, select, textarea {
            font-size: 16px !important;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .safe-pt { padding-top: calc(1rem + var(--sat)); }
        .safe-pb { padding-bottom: calc(1.5rem + var(--sab)); }

        /* 立體橢圓標籤 */
        .ellipse-3d {
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 4px 0 rgba(0,0,0,0.2);
        }
        .ellipse-3d:active {
            transform: translateY(2px);
            box-shadow: 0 1px 0 rgba(0,0,0,0.2);
        }

        @keyframes flower-float {
            0%, 100% { transform: translate(0,0) rotate(0deg) scale(1); }
            50% { transform: translate(30px, 20px) rotate(180deg) scale(1.1); }
        }
        .animate-flower {
            animation: flower-float 25s ease-in-out infinite;
        }

        @keyframes spin-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin-slow {
            animation: spin-slow 45s linear infinite;
        }

        .modal-enter {
            animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }
        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }

        .transition-theme { transition: background-color 0.8s, border-color 0.8s, color 0.8s; }
    </style>
</head>
<body class="h-full overflow-hidden">
    <div id="root" class="h-full overflow-hidden"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- Firebase 環境偵測與初始化 ---
        let firebaseConfig = {};
        try {
            if (typeof __firebase_config !== 'undefined' && __firebase_config) {
                // 預覽環境：使用內建變數
                firebaseConfig = JSON.parse(__firebase_config);
            } else {
                // ==========================================
                // 重要：請將下方的資訊替換成你 Firebase Console 提供的設定
                // ==========================================
                firebaseConfig = {
                    y: "AIzaSyD2GJHRM4vTUVrCGhheCK9UoEmvrwDiztU",
    authDomain: "kura-archive.firebaseapp.com",
    projectId: "kura-archive",
    storageBucket: "kura-archive.firebasestorage.app",
    messagingSenderId: "1005755387682",
    appId: "1:1005755387682:web:d3844fc4e22da3ddaddf7b",
    measurementId: "G-CT03C68RDC"};
            }
        } catch (e) { console.error("Firebase Config Parsing Error", e); }

        // 啟動 Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const auth = firebase.auth();
        const db = firebase.firestore();
        const app_collection_id = 'kura_archive_sarah_v3';

        const CURRENCY_RATES = { 'JPY': 0.21, 'USD': 32.5, 'KRW': 0.024, 'EUR': 35.2, 'TWD': 1 };

        // 圖標組件
        const Icon = ({ name, size = 24, className = "" }) => {
            const paths = {
                plus: "M12 5v14M5 12h14",
                sun: "M12 12m-4 0a4 4 0 1 0 8 0a4 4 0 1 0 -8 0 M12 2v2 M12 20v2 M4.22 4.22l1.42 1.42 M18.36 18.36l1.42 1.42 M2 12h2 M20 12h2 M4.22 19.78l1.42-1.42 M18.36 5.64l1.42 1.42",
                moon: "M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z",
                refresh: "M20 11a8.1 8.1 0 0 0 -15.5 -2m-.5 -4v4h4 M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4",
                external: "M12 6h-6a2 2 0 0 0 -2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-6 M11 13l9 -9 M15 4h5v5",
                trash: "M4 7h16 M10 11v6 M14 11v6 M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12 M9 7V4a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3",
                zap: "M13 2 3 14h9l-1 8 10-12h-9l1-8z",
                upload: "M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4m4-7 5-5 5 5m-5-5v12"
            };
            return (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d={paths[name]} />
                </svg>
            );
        };

        const App = () => {
            const [user, setUser] = useState(null);
            const [items, setItems] = useState([]);
            const [loading, setLoading] = useState(true);
            const [isDarkMode, setIsDarkMode] = useState(true);
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [activeTab, setActiveTab] = useState('全部');
            const [activeBrand, setActiveBrand] = useState('全部');
            const [isFetching, setIsFetching] = useState(false);
            const [isUpdating, setIsUpdating] = useState(false);
            const [lastVisitedId, setLastVisitedId] = useState(null);
            
            const fileInputRef = useRef(null);
            const [newItem, setNewItem] = useState({
                url: '', title: '', price: '', currency: 'JPY', category: '', brand: '', image: '', imageMode: 'url'
            });

            // 如果 apiKey 還是預設值，顯示引導畫面
            const isConfigMissing = !firebaseConfig.apiKey || firebaseConfig.apiKey.includes("你的");

            const themeColor = isDarkMode ? '#ec4899' : '#1a237e'; 
            const bgMain = isDarkMode ? '#222222' : '#d7ccc8';
            const bgContainer = isDarkMode ? '#1a1a1a' : '#bcaaa4';

            useEffect(() => {
                if (isConfigMissing) return;
                const unsub = auth.onAuthStateChanged(u => {
                    if (!u) auth.signInAnonymously();
                    setUser(u);
                });
                return () => unsub();
            }, [isConfigMissing]);

            useEffect(() => {
                if (!user) return;
                const itemsCol = db.collection('artifacts').doc(app_collection_id).collection('users').doc(user.uid).collection('wishlist');
                const unsubscribe = itemsCol.orderBy('createdAt', 'desc').onSnapshot(snap => {
                    const data = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    setItems(data);
                    setLoading(false);
                }, err => console.error("Firestore Listen Error:", err));
                return () => unsubscribe();
            }, [user]);

            useEffect(() => {
                const handleFocus = async () => {
                    if (document.visibilityState === 'visible' && lastVisitedId && user) {
                        const item = items.find(i => i.id === lastVisitedId);
                        if (item) fetchMetadata(item.url, true, item.id);
                        setLastVisitedId(null);
                    }
                };
                document.addEventListener('visibilitychange', handleFocus);
                return () => document.removeEventListener('visibilitychange', handleFocus);
            }, [lastVisitedId, items, user]);

            const brandsList = useMemo(() => ["全部", ...new Set(items.map(i => i.brand).filter(Boolean))], [items]);
            const categoriesList = useMemo(() => ["全部", ...new Set(items.map(i => i.category).filter(Boolean))], [items]);

            const bgFlowers = useMemo(() => {
                const flowers = [];
                for(let i = 0; i < 8; i++) {
                    flowers.push({
                        id: i,
                        t: [10, 20, 45, 50, 75, 85, 30, 65][i],
                        l: [15, 75, 20, 80, 15, 70, 45, 50][i],
                        size: Math.random() * 80 + 130, 
                        delay: Math.random() * -15,
                        duration: 20 + Math.random() * 10
                    });
                }
                return flowers;
            }, []);

            const fetchMetadata = async (url = newItem.url, isAutoSync = false, syncId = null) => {
                if (!url) return;
                if (isAutoSync) setIsUpdating(true); else setIsFetching(true);
                try {
                    const apiKey = ""; // Runtime 注入
                    const prompt = `分析網址並以 JSON 回傳最新商品資訊：{"title": "商品名", "price": "數字", "currency": "JPY/USD/TWD", "image": "圖片網址", "brand": "品牌", "category": "分類"}。網址：${url}`;
                    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }], generationConfig: { responseMimeType: "application/json" } })
                    });
                    const json = await res.json();
                    const meta = JSON.parse(json.candidates?.[0]?.content?.parts?.[0]?.text || "{}");
                    if (isAutoSync && syncId) {
                        const itemsCol = db.collection('artifacts').doc(app_collection_id).collection('users').doc(user.uid).collection('wishlist');
                        await itemsCol.doc(syncId).update({ price: meta.price, currency: meta.currency });
                    } else {
                        setNewItem(prev => ({ ...prev, ...meta }));
                    }
                } catch (e) { console.error(e); } finally { setIsFetching(false); setIsUpdating(false); }
            };

            const addItem = async () => {
                if (!newItem.title || !user) return;
                const itemsCol = db.collection('artifacts').doc(app_collection_id).collection('users').doc(user.uid).collection('wishlist');
                await itemsCol.add({ 
                    ...newItem, 
                    brand: newItem.brand || "其他",
                    category: newItem.category || "其他",
                    createdAt: new Date().toISOString(),
                    image: newItem.image || "https://images.unsplash.com/photo-1515886657613-9f3515b0c78f?q=80&w=1000&auto=format&fit=crop"
                });
                setNewItem({ url: '', title: '', price: '', currency: 'JPY', category: '', brand: '', image: '', imageMode: 'url' });
                setIsModalOpen(false);
            };

            const filteredItems = items.filter(i => (activeTab === '全部' || i.category === activeTab) && (activeBrand === '全部' || i.brand === activeBrand));

            if (isConfigMissing) {
                return (
                    <div className="flex items-center justify-center h-full bg-black text-white p-10 text-center font-pop">
                        <div>
                            <h2 className="text-3xl font-black mb-6 drop-shadow-[0_0_15px_#ec4899]">KURA 蔵</h2>
                            <p className="opacity-60 text-sm mb-4 leading-relaxed">偵測到設定尚未完成。</p>
                            <p className="opacity-40 text-[10px] mb-10 leading-relaxed uppercase tracking-widest">Please paste your Firebase configuration into index.html to activate the vault.</p>
                            <div className="animate-spin-slow inline-block text-pink-500 opacity-40">
                                <Icon name="refresh" size={48} />
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="flex justify-center h-full w-full transition-theme font-pop" style={{ backgroundColor: bgMain }}>
                    
                    <div className={`w-full max-w-[430px] h-full flex flex-col relative shadow-[0_0_100px_rgba(0,0,0,0.5)] overflow-hidden border-x-[3px] transition-theme ${isDarkMode ? 'border-pink-900/30 bg-[#1a1a1a]' : 'border-blue-900/10 bg-[#bcaaa4]'}`}>
                        
                        {/* 背景碎花 */}
                        <div className="absolute inset-0 pointer-events-none overflow-hidden z-0">
                            {bgFlowers.map(f => (
                                <div key={f.id} className="absolute animate-flower opacity-[0.35]" 
                                     style={{ top: `${f.t}%`, left: `${f.l}%`, width: f.size, height: f.size, animationDelay: `${f.delay}s`, animationDuration: `${f.duration}s`, color: themeColor }}>
                                    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 22C12 22 20 18 20 12C20 6 12 2 12 2C12 2 4 6 4 12C4 18 12 22 12 22Z" opacity="0.4"/><circle cx="12" cy="12" r="5"/></svg>
                                </div>
                            ))}
                        </div>

                        {/* Header */}
                        <header className={`sticky top-0 z-50 backdrop-blur-xl border-b pb-6 px-6 transition-all shadow-xl safe-pt ${isDarkMode ? 'bg-[#1a1a1a]/90 border-pink-900/50' : 'bg-[#bcaaa4]/90 border-blue-900/20'}`}>
                            <div className="flex justify-between items-center relative z-10">
                                <div>
                                    <h1 className={`text-4xl font-black italic flex items-baseline gap-2 ${isDarkMode ? 'drop-shadow-[0_0_15px_#ec4899] text-white' : 'drop-shadow-[0_0_10px_rgba(26,35,126,0.3)] text-[#1a237e]'}`}>
                                        KURA <span className={isDarkMode ? 'text-pink-400' : 'text-[#303f9f]'}>蔵</span>
                                    </h1>
                                    <div className={`h-[3.5px] w-14 mt-2 flex items-center gap-2 transition-theme ${isDarkMode ? 'bg-pink-500 shadow-[0_0_10px_#ec4899]' : 'bg-[#1a237e]'}`}>
                                        {isUpdating && <Icon name="refresh" size={12} className="animate-spin text-current" />}
                                    </div>
                                </div>
                                <button onClick={() => setIsDarkMode(!isDarkMode)} className="p-3 rounded-full border border-current opacity-70 bg-white/5 active:scale-90 transition-all">
                                    {isDarkMode ? <Icon name="sun" size={20} /> : <Icon name="moon" size={20} />}
                                </button>
                            </div>
                        </header>

                        {/* 標籤列 */}
                        <nav className="z-40 py-6 px-6 space-y-5 overflow-x-auto no-scrollbar">
                            <div className="flex gap-2.5">
                                {categoriesList.map(cat => (
                                    <button key={cat} onClick={() => setActiveTab(cat)} className={`ellipse-3d whitespace-nowrap px-5 py-2 text-[10px] font-black uppercase rounded-full border transition-all ${activeTab === cat ? (isDarkMode ? 'bg-pink-600 border-pink-400 shadow-[0_0_20px_#ec4899] text-white' : 'bg-[#1a237e] border-[#1a237e] text-white') : 'opacity-40 border-current bg-white/5'}`}>
                                        {cat}
                                    </button>
                                ))}
                            </div>
                            <div className="flex gap-8 border-y border-current/10 py-4">
                                {brandsList.map(brand => (
                                    <button key={brand} onClick={() => setActiveBrand(brand)} className={`whitespace-nowrap text-[11px] font-black uppercase transition-all ${activeBrand === brand ? 'scale-125 opacity-100 font-black' : 'opacity-30'}`}>
                                        {brand}
                                    </button>
                                ))}
                            </div>
                        </nav>

                        {/* 商品內容區域 */}
                        <main className="flex-1 px-5 py-4 z-20 overflow-y-auto no-scrollbar">
                            {loading ? (
                                <div className="flex flex-col items-center py-32 animate-pulse opacity-50 font-black">
                                    <Icon name="refresh" className="animate-spin mb-4" size={40} />
                                    SYNCING VAULT...
                                </div>
                            ) : (
                                <div className="grid grid-cols-2 gap-5 pb-40">
                                    {filteredItems.map(item => (
                                        <div key={item.id} className={`group relative flex flex-col p-3 rounded-[2.2rem] border transition-all duration-500 ${isDarkMode ? 'bg-white/5 border-white/10 hover:border-pink-500/50' : 'bg-white/40 border-[#1a237e]/10 hover:border-[#1a237e]/40 shadow-sm'} hover:shadow-2xl`}>
                                            <div className="aspect-[4/5] rounded-[1.8rem] overflow-hidden mb-4 relative shadow-inner bg-black/10">
                                                <img src={item.image} alt="" className="w-full h-full object-cover grayscale group-hover:grayscale-0 transition-all duration-1000 scale-110 group-hover:scale-100" />
                                                <button onClick={(e) => { e.preventDefault(); db.collection('artifacts').doc(app_collection_id).collection('users').doc(user.uid).collection('wishlist').doc(item.id).delete(); }} className="absolute top-2 right-2 p-2.5 bg-black/60 text-white rounded-full opacity-0 group-hover:opacity-100 transition-all hover:bg-red-500">✕</button>
                                                <div className={`absolute bottom-3 left-3 px-3 py-1 text-[9px] font-black text-white rounded-lg shadow-xl ${isDarkMode ? 'bg-pink-600' : 'bg-[#1a237e]'}`}>{item.brand}</div>
                                            </div>
                                            <h3 className="text-[12px] font-black line-clamp-2 h-9 mb-3 leading-snug">{item.title}</h3>
                                            <div className="mt-auto flex justify-between items-end border-t border-current/10 pt-3">
                                                <div>
                                                    <div className={`text-[14px] font-black font-mono tracking-tighter ${isDarkMode ? 'text-pink-400' : 'text-[#1a237e]'}`}>{item.currency} {item.price}</div>
                                                    <div className="text-[9px] opacity-40 font-bold italic tracking-widest mt-0.5">≈ TWD ${Math.round(item.price * (CURRENCY_RATES[item.currency] || 1))}</div>
                                                </div>
                                                <a href={item.url} target="_blank" onClick={() => setLastVisitedId(item.id)} className="p-3 rounded-2xl bg-current/10 hover:bg-current/20 transition-all active:scale-90 shadow-sm">
                                                    <Icon name="external" size={16} />
                                                </a>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </main>

                        {/* 右下角懸浮按鈕 */}
                        <div className="fixed bottom-0 right-0 p-8 z-50 safe-pb">
                            <button 
                                onClick={() => setIsModalOpen(true)}
                                className={`group relative p-6 rounded-full bg-black text-white shadow-[0_20px_50px_rgba(0,0,0,0.5)] active:scale-90 transition-all overflow-hidden border-2 ${isDarkMode ? 'border-pink-500 shadow-pink-500/20' : 'border-[#1a237e] shadow-[#1a237e]/20'}`}
                            >
                                <div className={`absolute inset-0 opacity-0 group-hover:opacity-40 transition-opacity ${isDarkMode ? 'bg-pink-600' : 'bg-[#1a237e]'}`}></div>
                                <div className="absolute inset-0 animate-spin-slow opacity-20 scale-150 pointer-events-none">
                                    <svg viewBox="0 0 24 24" fill="currentColor" className={isDarkMode ? 'text-pink-400' : 'text-[#3f51b5]'}><circle cx="12" cy="12" r="5"/></svg>
                                </div>
                                <Icon name="plus" size={32} strokeWidth={4} className="relative z-10" />
                            </button>
                        </div>

                        {/* 頁尾 */}
                        <footer className="pt-24 pb-40 text-center opacity-30 text-[10px] uppercase font-black tracking-[0.5em] transition-theme safe-pb px-10 leading-relaxed">
                            Designed by Sarah • 2025
                        </footer>

                        {/* 新增商品 Modal (全功能修復) */}
                        {isModalOpen && (
                            <div className="fixed inset-0 z-[100] flex items-end justify-center">
                                <div className="absolute inset-0 bg-black/95 backdrop-blur-md" onClick={() => setIsModalOpen(false)}></div>
                                <div className={`relative w-full max-w-md p-8 rounded-t-[3.5rem] border-t-2 modal-enter transition-theme safe-pb ${isDarkMode ? 'bg-[#222222] border-pink-900/50 text-white' : 'bg-[#d7ccc8] border-[#1a237e]/30 text-[#1a237e]'}`}>
                                    <div className={`h-2.5 w-24 absolute top-4 left-1/2 -translate-x-1/2 rounded-full opacity-20 ${isDarkMode ? 'bg-white' : 'bg-[#1a237e]'}`}></div>
                                    
                                    <div className="flex justify-between items-center mb-8 mt-4">
                                        <h2 className="text-3xl font-black italic uppercase flex items-center gap-3">Vault Entry <Icon name="zap" className="animate-bounce" /></h2>
                                        <button onClick={() => setIsModalOpen(false)} className="p-2 opacity-50 text-2xl">✕</button>
                                    </div>

                                    <div className="space-y-6 overflow-y-auto no-scrollbar max-h-[75vh] pb-10">
                                        {/* URL 輸入與抓取 */}
                                        <div className="space-y-2">
                                            <label className="text-[10px] font-black uppercase opacity-60 tracking-widest">Blueprint URL</label>
                                            <div className="flex gap-2">
                                                <input type="text" placeholder="https://..." className="flex-1 bg-white/10 border-b-2 border-current/20 p-3 outline-none focus:border-current transition-all font-mono" value={newItem.url} onChange={e => setNewItem({...newItem, url: e.target.value})} />
                                                <button onClick={() => fetchMetadata()} className={`px-6 py-3 rounded-2xl text-xs font-black text-white shadow-xl ${isDarkMode ? 'bg-pink-600 hover:bg-pink-700' : 'bg-[#1a237e] hover:bg-[#0d1642]'}`}>
                                                    {isFetching ? '...' : 'GET'}
                                                </button>
                                            </div>
                                        </div>

                                        {/* 圖片來源切換 */}
                                        <div className="space-y-3">
                                            <div className="flex gap-4 border-b border-current/10 pb-2">
                                                <button onClick={() => setNewItem({...newItem, imageMode: 'url'})} className={`text-[10px] font-black tracking-widest pb-1 border-b-2 transition-all ${newItem.imageMode === 'url' ? 'border-current' : 'opacity-20 border-transparent'}`}>LINK</button>
                                                <button onClick={() => setNewItem({...newItem, imageMode: 'upload'})} className={`text-[10px] font-black tracking-widest pb-1 border-b-2 transition-all ${newItem.imageMode === 'upload' ? 'border-current' : 'opacity-20 border-transparent'}`}>UPLOAD</button>
                                            </div>
                                            {newItem.imageMode === 'url' ? (
                                                <input placeholder="Image URL..." className="w-full bg-transparent border-b-2 border-current/20 p-2 text-sm outline-none font-mono" value={newItem.image} onChange={e => setNewItem({...newItem, image: e.target.value})} />
                                            ) : (
                                                <div className="border-2 border-dashed border-current/20 rounded-2xl p-6 text-center cursor-pointer bg-white/5" onClick={() => fileInputRef.current.click()}>
                                                    <input type="file" ref={fileInputRef} className="hidden" accept="image/*" onChange={e => {
                                                        const file = e.target.files[0];
                                                        if (file) {
                                                            const reader = new FileReader();
                                                            reader.onloadend = () => setNewItem(prev => ({ ...prev, image: reader.result, imageMode: 'upload' }));
                                                            reader.readAsDataURL(file);
                                                        }
                                                    }} />
                                                    <Icon name="upload" className="mx-auto mb-2 opacity-50" />
                                                    <p className="text-[10px] font-black opacity-40 uppercase">CHOOSE FILE</p>
                                                </div>
                                            )}
                                        </div>

                                        {/* 標題與品牌 */}
                                        <div className="grid grid-cols-2 gap-5">
                                            <div className="space-y-1">
                                                <label className="text-[9px] font-black opacity-50 uppercase">Artifact Title</label>
                                                <input placeholder="Name" className="w-full bg-transparent border-b-2 border-current/20 p-2 text-sm outline-none" value={newItem.title} onChange={e => setNewItem({...newItem, title: e.target.value})} />
                                            </div>
                                            <div className="space-y-1">
                                                <label className="text-[9px] font-black opacity-50 uppercase">Brand</label>
                                                <input placeholder="Brand" className="w-full bg-transparent border-b-2 border-current/20 p-2 text-sm outline-none" value={newItem.brand} onChange={e => setNewItem({...newItem, brand: e.target.value})} />
                                            </div>
                                        </div>

                                        {/* 分類與價格 */}
                                        <div className="grid grid-cols-2 gap-5">
                                            <div className="space-y-1">
                                                <label className="text-[9px] font-black opacity-50 uppercase">Category</label>
                                                <input placeholder="Tag" className="w-full bg-transparent border-b-2 border-current/20 p-2 text-sm outline-none" value={newItem.category} onChange={e => setNewItem({...newItem, category: e.target.value})} />
                                            </div>
                                            <div className="grid grid-cols-2 gap-2">
                                                <div className="space-y-1">
                                                    <label className="text-[9px] font-black opacity-50 uppercase">Price</label>
                                                    <input type="number" className="w-full bg-transparent border-b-2 border-current/20 p-3 text-sm outline-none font-mono" value={newItem.price} onChange={e => setNewItem({...newItem, price: e.target.value})} />
                                                </div>
                                                <div className="space-y-1">
                                                    <label className="text-[9px] font-black opacity-50 uppercase">Curr</label>
                                                    <select className="w-full bg-transparent border-b-2 border-current/20 p-3 text-xs outline-none font-mono" value={newItem.currency} onChange={e => setNewItem({...newItem, currency: e.target.value})}>
                                                        {Object.keys(CURRENCY_RATES).map(c => <option key={c} value={c} className="text-black">{c}</option>)}
                                                    </select>
                                                </div>
                                            </div>
                                        </div>

                                        <button onClick={addItem} className={`w-full py-6 rounded-[2.5rem] text-white font-black uppercase text-lg shadow-2xl transition-all active:scale-95 mt-4 ${isDarkMode ? 'bg-pink-600 shadow-pink-500/40 hover:bg-pink-500' : 'bg-[#1a237e] shadow-[#1a237e]/30 hover:bg-[#0d1642]'}`}>
                                            Archive Consignment 蔵
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // 確保在腳本載入後渲染
        window.addEventListener('DOMContentLoaded', () => {
            const root = ReactDOM.createRoot(document.getElementById('root'));
            root.render(<App />);
        });
    </script>
</body>
</html>

